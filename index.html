<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Terabox Downloader - Download & Play Files From Terabox</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3f37c9;
            --accent: #4cc9f0;
            --text: #212529;
            --bg-light: #f8f9fa;
            --bg-dark: #212529;
            --gray-light: #e9ecef;
            --success: #38b000;
            --warning: #ffaa00;
            --danger: #d90429;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
        body { color: var(--text); background-color: var(--bg-light); line-height: 1.6; }
        .container { width: 100%; max-width: 1200px; margin: 0 auto; padding: 0 20px; }
        
        header { background-color: white; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1); position: sticky; top: 0; z-index: 100; }
        .navbar { display: flex; justify-content: space-between; align-items: center; padding: 15px 0; }
        .logo { display: flex; align-items: center; text-decoration: none; }
        .logo h1 { font-size: 1.8rem; font-weight: 700; color: var(--primary); margin-left: 10px; }
        .logo-icon { font-size: 2rem; color: var(--primary); }
        .nav-links { display: flex; list-style: none; }
        .nav-links li { margin-left: 20px; position: relative; }
        .nav-links a { text-decoration: none; color: var(--text); font-weight: 500; font-size: 1rem; transition: color 0.3s; cursor: pointer; }
        .nav-links a:hover { color: var(--primary); }
        .hamburger { display: none; cursor: pointer; background: none; border: none; font-size: 1.5rem; color: var(--text); }
        
        .hero { background: linear-gradient(135deg, var(--primary), var(--secondary)); color: white; padding: 80px 0; text-align: center; }
        .hero h2 { font-size: 2.5rem; font-weight: 700; margin-bottom: 20px; }
        .hero p { font-size: 1.1rem; margin-bottom: 30px; max-width: 800px; margin-left: auto; margin-right: auto; }
        
        .input-section { padding: 50px 0; }
        .input-box { max-width: 600px; margin: 0 auto; padding: 40px 20px; background-color: white; border-radius: 10px; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1); }
        .input-group { position: relative; margin-bottom: 20px; }
        .input-field { width: 100%; padding: 15px 45px 15px 15px; border: 2px solid var(--gray-light); border-radius: 5px; font-size: 1rem; transition: border-color 0.3s; }
        .input-field:focus { border-color: var(--primary); outline: none; }
        label[for="link"] { position: absolute; left: 15px; top: 17px; font-size: 1rem; color: #6c757d; pointer-events: none; transition: all 0.3s ease; }
        .input-field:focus ~ label[for="link"], .input-field:not(:placeholder-shown) ~ label[for="link"], label[for="link"].float { top: -10px; left: 10px; font-size: 0.8rem; background-color: white; padding: 0 5px; color: var(--primary); }
        .paste-btn { position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; color: var(--primary); font-size: 1.2rem; }
        .buttonTera { display: block; width: 100%; padding: 15px; background-color: var(--primary); color: white; border: none; border-radius: 5px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: background-color 0.3s; }
        .buttonTera:hover { background-color: var(--secondary); }
        .message-area { display: none; margin-top: 15px; padding: 10px; border-radius: 5px; font-size: 0.9rem; text-align: center; }
        .message-area.success { background-color: #e6ffed; color: var(--success); border: 1px solid var(--success); }
        .message-area.error { background-color: #ffebee; color: var(--danger); border: 1px solid var(--danger); }
        .message-area.info { background-color: #e3f2fd; color: var(--primary); border: 1px solid var(--primary); }

        .player-section { display: none; padding: 30px 0; background-color: #f0f2f5; }
        .player-wrapper { max-width: 800px; margin: 0 auto; background-color: white; border-radius: 10px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); padding: 20px; }
        .player-wrapper h3 { font-size: 1.5rem; color: var(--primary); margin-bottom: 15px; text-align: center; }
        .file-info-display { font-size: 0.9rem; color: #555; background-color: var(--gray-light); padding: 10px; border-radius: 5px; margin-bottom: 15px; word-break: break-all; }
        .file-info-display strong { color: var(--text); }
        .iframe-container { position: relative; width: 100%; padding-top: 56.25%; background-color: #000; border-radius: 5px; overflow: hidden; margin-bottom: 20px; }
        #teraboxPlayer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none; }
        .player-controls { text-align: center; }
        .direct-download-btn { /* This is an <a> tag now */
            display: inline-block;
            padding: 12px 25px;
            background-color: var(--success);
            color: white;
            text-decoration: none;
            border-radius: 5px;
            font-weight: 500;
            transition: background-color 0.3s ease;
            font-size: 1rem;
            border: none; /* For <a> tag */
        }
        .direct-download-btn:hover { background-color: #2a9100; }
        .direct-download-btn.disabled { background-color: #aaa; cursor: not-allowed; }
        .download-note { font-size: 0.85rem; color: #666; margin-top: 10px; }
        
        .features { padding: 80px 0; text-align: center; }
        .section-title { font-size: 2rem; font-weight: 700; margin-bottom: 50px; position: relative; display: inline-block; }
        .section-title::after { content: ""; position: absolute; bottom: -10px; left: 50%; transform: translateX(-50%); width: 80px; height: 4px; background-color: var(--primary); border-radius: 2px; }
        .features-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 30px; margin-top: 50px; }
        .feature { background-color: white; padding: 30px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1); transition: transform 0.3s; text-align: left; }
        .feature:hover { transform: translateY(-5px); }
        .feature-icon { font-size: 2.5rem; color: var(--primary); margin-bottom: 20px; display: block; text-align: center;  }
        .feature h3 { font-size: 1.3rem; font-weight: 600; margin-bottom: 15px; text-align: center; }
        
        .how-to-use { padding: 80px 0; background-color: var(--bg-light); text-align: center; }
        .steps-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 30px; margin-top: 50px; }
        .step { text-align: center; padding: 30px; background-color: white; border-radius: 10px; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1); position: relative; }
        .step-number { position: absolute; top: -15px; left: 50%; transform: translateX(-50%); background-color: var(--primary); color: white; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600; }
        .step-icon { font-size: 2rem; color: var(--primary); margin-bottom: 15px; }
        
        .supported-urls { padding: 80px 0; background-color: white; text-align: center; }
        .urls-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; margin-top: 40px; }
        .url-item { padding: 10px; background-color: var(--bg-light); border-radius: 5px; text-align: center; font-weight: 500; color: var(--text); }
        
        .faq { padding: 80px 0; background-color: var(--bg-light); }
        .accordion { max-width: 800px; margin: 50px auto 0; }
        .faq-item { background-color: white; border-radius: 5px; margin-bottom: 15px; overflow: hidden; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1); }
        .faq-question { padding: 20px; font-weight: 600; cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
        .faq-question.active { color: var(--primary); }
        .faq-toggle { font-size: 1.2rem; transition: transform 0.3s; font-weight: bold; }
        .faq-answer { padding: 0 20px; max-height: 0; overflow: hidden; transition: max-height 0.4s ease-out, padding 0.4s ease-out; color: #555; }
        .faq-answer.open { padding-top: 0; padding-bottom: 20px; }
        
        footer { background-color: var(--bg-dark); color: white; padding: 50px 0 20px; }
        .footer-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 30px; margin-bottom: 30px; }
        .footer-section h3 { font-size: 1.3rem; font-weight: 600; margin-bottom: 20px; }
        .footer-links { list-style: none; } .footer-links li { margin-bottom: 10px; }
        .footer-links a { text-decoration: none; color: #adb5bd; transition: color 0.3s; cursor: pointer; }
        .footer-links a:hover { color: white; }
        .social-icons { display: flex; gap: 15px; margin-top: 20px; }
        .social-icon { width: 40px; height: 40px; background-color: #495057; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.2rem; text-decoration: none; transition: background-color 0.3s; }
        .social-icon:hover { background-color: var(--primary); }
        .footer-bottom { text-align: center; padding-top: 30px; border-top: 1px solid #495057; color: #adb5bd; font-size: 0.9rem; }
        
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.6); z-index: 1000; overflow-y: auto; align-items: center; justify-content: center; padding: 20px; }
        .modal-content { background-color: white; padding: 30px; max-width: 700px; width: 100%; border-radius: 10px; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3); position: relative; animation: modalFadeIn 0.3s ease-out; }
        @keyframes modalFadeIn { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
        .modal-close-btn { position: absolute; top: 15px; right: 20px; font-size: 1.8rem; cursor: pointer; color: #adb5bd; transition: color 0.3s; line-height: 1; }
        .modal-close-btn:hover { color: var(--text); }
        .modal-content h2 { color: var(--primary); margin-bottom: 20px; }
        .modal-content p, .modal-content li { margin-bottom: 10px; color: #555; }
        .modal-content .social-icons a { background-color: var(--gray-light); color: var(--primary); }
        .modal-content .social-icons a:hover { background-color: var(--primary); color: white; }
        .modal-content form input, .modal-content form textarea { width: 100%; padding: 10px; border: 1px solid var(--gray-light); border-radius: 5px; margin-bottom: 10px; }
        .modal-content form button { padding: 10px 20px; background-color: var(--primary); color: white; border: none; border-radius: 5px; cursor: pointer; transition: background-color 0.3s; }
        .modal-content form button:hover { background-color: var(--secondary); }
        
        @media (max-width: 768px) {
            .navbar { flex-wrap: wrap; position: relative; }
            .nav-links { display: none; flex-direction: column; width: 100%; background-color: white; position: absolute; top: 100%; left: 0; padding: 15px 0; box-shadow: 0 5px 10px rgba(0,0,0,0.1); z-index: 99; }
            .nav-links.show { display: flex; }
            .nav-links li { margin-left: 0; margin-bottom: 0; width: 100%; text-align: center; }
            .nav-links li a { display: block; padding: 10px 20px; }
            .hamburger { display: block; }
            .hero h2 { font-size: 2rem; } .hero p { font-size: 1rem; }
            .section-title { font-size: 1.8rem; }
            .features-grid, .steps-grid { grid-template-columns: 1fr; }
            .modal-content { padding: 20px; }
        }
    </style>
</head>
<body>
    <div id="mainPage">
        <header>
            <div class="container">
                <nav class="navbar">
                    <a href="#" class="logo"><i class="fas fa-cloud-download-alt logo-icon"></i><h1>TeraDownloader</h1></a>
                    <button class="hamburger" id="hamburgerBtn"><i class="fas fa-bars"></i></button>
                    <ul class="nav-links" id="navLinks">
                        <li><a id="aboutUsLink">About Us</a></li>
                        <li><a id="contactUsLink">Contact Us</a></li>
                        <li><a href="#faq">FAQ</a></li>
                    </ul>
                </nav>
            </div>
        </header>

        <section class="hero">
            <div class="container">
                <h2>TeraBox Downloader & Player</h2>
                <p>Easily play and access download options for files from Terabox links. Fast, secure, and user-friendly.</p>
            </div>
        </section>

        <section class="input-section">
            <div class="container">
                <div class="input-box">
                    <div class="input-group">
                        <input type="url" id="link" class="input-field" placeholder=" ">
                        <label for="link">Paste Terabox URL here</label>
                        <button class="paste-btn" id="pasteBtn" title="Paste from clipboard"><i class="fas fa-paste"></i></button>
                    </div>
                    <button class="buttonTera" id="getVideoBtn">Load Media & Get Download Link</button>
                    <div id="messageArea" class="message-area"></div>
                </div>
            </div>
        </section>

        <section class="player-section" id="playerSection">
            <div class="container">
                <div class="player-wrapper">
                    <h3>Media Player / Download</h3>
                    <div class="file-info-display" id="fileInfoDisplay">
                        <strong>URL:</strong> <span id="loadedFileUrl">N/A</span><br>
                        <strong>Name:</strong> <span id="loadedFileName">N/A</span><br>
                        <strong>Size:</strong> <span id="loadedFileSize">N/A</span>
                    </div>
                    <div class="iframe-container">
                        <iframe id="teraboxPlayer" allowfullscreen title="Terabox Media Player"></iframe>
                    </div>
                    <div class="player-controls">
                        <a href="#" id="directDownloadBtn" class="direct-download-btn disabled" target="_blank" rel="noopener noreferrer">
                            <i class="fas fa-download"></i> Download File
                        </a>
                        <p class="download-note">
                            Clicking above attempts to start the download or takes you to the download page.
                            The player above might also offer its own download/play controls.
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <section class="features">
             <div class="container">
                <h2 class="section-title">What is Terabox?</h2>
                <p style="max-width: 800px; margin: 0 auto 30px auto;">TeraBox is a cloud storage service offering 1TB of free storage for files, documents, photos, videos, and more, enabling easy storage and sharing across devices.</p>
                <div class="features-grid">
                    <div class="feature"><i class="fas fa-cloud feature-icon"></i><h3>Cloud Storage</h3><p>1TB of free cloud storage.</p></div>
                    <div class="feature"><i class="fas fa-share-alt feature-icon"></i><h3>Easy Sharing</h3><p>Generate shareable links.</p></div>
                    <div class="feature"><i class="fas fa-mobile-alt feature-icon"></i><h3>Multi-Platform</h3><p>Access files from any device.</p></div>
                </div>
                <h2 class="section-title" style="margin-top: 80px;">What This Tool Does</h2>
                <p style="max-width: 800px; margin: 0 auto 30px auto;">This tool helps you process Terabox links to play media in an embedded player and access potential download links provided by an external service.</p>
                <div class="features-grid">
                    <div class="feature"><i class="fas fa-cogs feature-icon"></i><h3>Link Processing</h3><p>Uses an external API to fetch details and download links for your Terabox URL.</p></div>
                    <div class="feature"><i class="fas fa-play-circle feature-icon"></i><h3>Embedded Player</h3><p>Streams videos using the player.teraboxfast.com service directly on this page.</p></div>
                    <div class="feature"><i class="fas fa-link feature-icon"></i><h3>Download Access</h3><p>Provides a button with the download link obtained from the API, or a link to the original Terabox page.</p></div>
                </div>
            </div>
        </section>

        <section class="how-to-use">
            <div class="container">
                <h2 class="section-title">How to Use</h2>
                <p style="max-width: 800px; margin: 0 auto 30px auto;">Follow these simple steps:</p>
                <div class="steps-grid">
                    <div class="step"><div class="step-number">1</div><i class="fas fa-link step-icon"></i><h3>Copy Link</h3><p>Copy the Terabox file link.</p></div>
                    <div class="step"><div class="step-number">2</div><i class="fas fa-paste step-icon"></i><h3>Paste URL</h3><p>Paste the URL into the input field.</p></div>
                    <div class="step"><div class="step-number">3</div><i class="fas fa-hand-pointer step-icon"></i><h3>Click Load</h3><p>Click "Load Media & Get Download Link".</p></div>
                    <div class="step"><div class="step-number">4</div><i class="fas fa-photo-video step-icon"></i><h3>View/Download</h3><p>Player loads below. Use the "Download File" button or check player controls.</p></div>
                </div>
            </div>
        </section>

        <section class="supported-urls">
            <div class="container">
                <h2 class="section-title">Supported Terabox URLs</h2>
                <p style="max-width: 800px; margin: 0 auto 30px auto;">This tool processes links from common Terabox domains. The actual success depends on the external API.</p>
                <div class="urls-grid" id="supportedUrlsGrid"></div>
            </div>
        </section>

        <section class="faq" id="faq">
            <div class="container">
                <h2 class="section-title">Frequently Asked Questions</h2>
                <div class="accordion">
                    <div class="faq-item"><div class="faq-question"><span>Is this tool free?</span><span class="faq-toggle">+</span></div><div class="faq-answer"><p>Yes, this tool is free to use.</p></div></div>
                    <div class="faq-item"><div class="faq-question"><span>Do I need an account?</span><span class="faq-toggle">+</span></div><div class="faq-answer"><p>No account is needed for this tool. Terabox may have its own site requirements.</p></div></div>
                    <div class="faq-item"><div class="faq-question"><span>How does downloading work?</span><span class="faq-toggle">+</span></div><div class="faq-answer"><p>This tool uses an external API to try and get a download link. The "Download File" button will use that link. If no direct link is found by the API, the button may redirect you to the original Terabox page for download options. The embedded player might also have its own download button.</p></div></div>
                    <div class="faq-item"><div class="faq-question"><span>Are there file size limits?</span><span class="faq-toggle">+</span></div><div class="faq-answer"><p>This tool doesn't set limits. Limits depend on Terabox and the external API/player services.</p></div></div>
                    <div class="faq-item"><div class="faq-question"><span>Is this tool safe?</span><span class="faq-toggle">+</span></div><div class="faq-answer"><p>This website itself is safe and doesn't store your links. It relies on third-party services (the API and the player) for its core functionality. Use them at your own discretion.</p></div></div>
                </div>
            </div>
        </section>

        <footer>
            <div class="container">
                <div class="footer-grid">
                    <div class="footer-section"><h3>TeraBox Downloader</h3><p>Access Terabox files easily.</p><div class="social-icons"><a href="#" class="social-icon" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a><a href="#" class="social-icon" aria-label="Twitter"><i class="fab fa-twitter"></i></a><a href="#" class="social-icon" aria-label="Instagram"><i class="fab fa-instagram"></i></a></div></div>
                    <div class="footer-section"><h3>Quick Links</h3><ul class="footer-links"><li><a href="#">Home</a></li><li><a id="footerAboutUsLink">About Us</a></li><li><a id="footerContactUsLink">Contact Us</a></li><li><a href="#faq">FAQ</a></li></ul></div>
                    <div class="footer-section"><h3>Legal</h3><ul class="footer-links"><li><a href="#">Terms</a></li><li><a href="#">Privacy</a></li><li><a href="#">Disclaimer</a></li></ul></div>
                    <div class="footer-section"><h3>Contact</h3><ul class="footer-links"><li><i class="fas fa-envelope" style="margin-right: 8px;"></i> support@example.com</li></ul></div>
                </div>
                <div class="footer-bottom"><p>© <span id="currentYear"></span> TeraBox Downloader. All rights reserved.</p><p>Not affiliated with Terabox or Flextech Inc.</p></div>
            </div>
        </footer>
    </div>

    <div id="aboutUsModal" class="modal"><div class="modal-content"><span class="modal-close-btn" id="closeAboutModal">×</span><h2>About Us</h2><p>This tool helps access Terabox files using external services for playback and download link retrieval. User privacy is respected on this site; no links are stored by us.</p></div></div>
    <div id="contactUsModal" class="modal"><div class="modal-content"><span class="modal-close-btn" id="closeContactModal">×</span><h2>Contact Us</h2><p>Questions or feedback? Email: support@example.com (Placeholder)</p><form id="contactForm" style="margin-top:20px;"><div><label for="contact_name" style="display:block;margin-bottom:5px;">Name</label><input type="text" id="contact_name" required></div><div><label for="contact_email" style="display:block;margin-bottom:5px;">Email</label><input type="email" id="contact_email" required></div><div><label for="contact_message" style="display:block;margin-bottom:5px;">Message</label><textarea id="contact_message" rows="3" required></textarea></div><button type="submit">Send</button></form></div></div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- UI Elements ---
        const hamburgerBtn = document.getElementById('hamburgerBtn');
        const navLinksUl = document.getElementById('navLinks');
        const aboutUsLink = document.getElementById('aboutUsLink');
        const contactUsLink = document.getElementById('contactUsLink');
        const footerAboutUsLink = document.getElementById('footerAboutUsLink');
        const footerContactUsLink = document.getElementById('footerContactUsLink');
        const aboutUsModal = document.getElementById('aboutUsModal');
        const contactUsModal = document.getElementById('contactUsModal');
        const closeAboutModalBtn = document.getElementById('closeAboutModal');
        const closeContactModalBtn = document.getElementById('closeContactModal');
        const contactForm = document.getElementById('contactForm');
        const urlInput = document.getElementById('link');
        const label = document.querySelector('label[for="link"]');
        const pasteBtn = document.getElementById('pasteBtn');
        const getVideoBtn = document.getElementById('getVideoBtn');
        const messageArea = document.getElementById('messageArea');
        const currentYearSpan = document.getElementById('currentYear');
        
        const playerSection = document.getElementById('playerSection');
        const teraboxPlayerIframe = document.getElementById('teraboxPlayer');
        const directDownloadBtn = document.getElementById('directDownloadBtn'); // This is now an <a> tag
        const loadedFileUrlSpan = document.getElementById('loadedFileUrl');
        const loadedFileNameSpan = document.getElementById('loadedFileName');
        const loadedFileSizeSpan = document.getElementById('loadedFileSize'); // Added for file size
        
        let currentOriginalTeraboxLink = ''; // Stores the user-provided, validated Terabox link

        // --- Helper Functions ---
        function openModal(modal) { 
            if (modal) {
                modal.style.display = 'flex';
                if (navLinksUl.classList.contains('show')) navLinksUl.classList.remove('show');
            }
        }
        function closeModal(modal) { if (modal) modal.style.display = 'none'; }

        function showMessage(message, type) {
            if (messageArea) {
                messageArea.textContent = message;
                messageArea.className = 'message-area';
                if (type) messageArea.classList.add(type);
                messageArea.style.display = message ? 'block' : 'none';
            }
        }
        
        const supportedDomains = [
            "www.mirrobox.com", "www.nephobox.com", "freeterabox.com", "www.freeterabox.com",
            "1024tera.com", "4funbox.co", "www.4funbox.com", "mirrobox.com", "nephobox.com",
            "terabox.app", "terabox.com", "www.terabox.ap", "terabox.fun", 
            "www.1024tera.co", "www.momerybox.com", "teraboxapp.com", "momerybox.com",
            "tibibox.com", "www.tibibox.com", "www.teraboxapp.com"
        ];

        function isValidTeraboxUrl(url) {
            if (!url) return false;
            try {
                const parsedUrl = new URL(url);
                let hostname = parsedUrl.hostname;
                const isSupportedDomain = supportedDomains.includes(hostname) || 
                                          (hostname.startsWith('www.') && supportedDomains.includes(hostname.substring(4)));
                if (!isSupportedDomain) return false;
                return parsedUrl.pathname.includes('/s/') || 
                       parsedUrl.search.includes('surl=') ||
                       parsedUrl.pathname.includes('/share/link') ||
                       parsedUrl.pathname.length > 3; // Basic check for short IDs
            } catch (e) { return false; }
        }

        // --- API Call Function ---
        async function fetchTeraboxLinkDetails(teraboxUrl) {
            const apiUrl = 'https://webb.teraboxfast.workers.dev/';
            const requestBody = { url: teraboxUrl, key: 'directdwn' };

            showMessage('Fetching link details from API...', 'info');
            playerSection.style.display = 'block'; // Show section for loading message
            teraboxPlayerIframe.src = 'about:blank';
            directDownloadBtn.href = '#'; // Reset
            directDownloadBtn.classList.add('disabled');
            directDownloadBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';


            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestBody)
                });
                const data = await response.json();

                if (data && data.status === 'success' && data.data) {
                    showMessage('API details fetched successfully!', 'success');
                    return data.data; 
                } else {
                    const errorMessage = data && data.message ? data.message : 'API request failed or returned an unexpected format.';
                    showMessage(errorMessage, 'error');
                    console.error('API Error:', errorMessage, data);
                    directDownloadBtn.innerHTML = '<i class="fas fa-times-circle"></i> API Error';
                    return null;
                }
            } catch (error) {
                showMessage('Network error: Could not connect to the link processing service.', 'error');
                console.error('Fetch Network Error:', error);
                directDownloadBtn.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Network Error';
                return null;
            }
        }

        // --- Event Listeners ---
        if (hamburgerBtn && navLinksUl) {
            hamburgerBtn.addEventListener('click', () => navLinksUl.classList.toggle('show'));
        }
        navLinksUl.querySelectorAll('a').forEach(link => {
            link.addEventListener('click', () => {
                if (navLinksUl.classList.contains('show')) {
                    if (link.getAttribute('href') && link.getAttribute('href').startsWith('#')) {
                       navLinksUl.classList.remove('show');
                    } else if (link.id.includes('UsLink')) {
                        navLinksUl.classList.remove('show');
                    }
                }
            });
        });

        if (aboutUsLink) aboutUsLink.addEventListener('click', (e) => { e.preventDefault(); openModal(aboutUsModal); });
        if (contactUsLink) contactUsLink.addEventListener('click', (e) => { e.preventDefault(); openModal(contactUsModal); });
        if (footerAboutUsLink) footerAboutUsLink.addEventListener('click', (e) => { e.preventDefault(); openModal(aboutUsModal); });
        if (footerContactUsLink) footerContactUsLink.addEventListener('click', (e) => { e.preventDefault(); openModal(contactUsModal); });
        if (closeAboutModalBtn) closeAboutModalBtn.addEventListener('click', () => closeModal(aboutUsModal));
        if (closeContactModalBtn) closeContactModalBtn.addEventListener('click', () => closeModal(contactUsModal));
        window.addEventListener('click', (event) => {
            if (event.target === aboutUsModal) closeModal(aboutUsModal);
            if (event.target === contactUsModal) closeModal(contactUsModal);
        });
        window.addEventListener('keydown', (event) => {
            if (event.key === 'Escape') { closeModal(aboutUsModal); closeModal(contactUsModal); }
        });

        if (contactForm) {
            contactForm.addEventListener('submit', (e) => {
                e.preventDefault();
                alert('Thank you for your message! (This is a demo form)');
                closeModal(contactUsModal);
                contactForm.reset();
            });
        }

        document.querySelectorAll('.faq-item .faq-question').forEach(question => {
            question.addEventListener('click', () => {
                const answer = question.nextElementSibling;
                const toggle = question.querySelector('.faq-toggle');
                const isOpen = answer.classList.contains('open');
                document.querySelectorAll('.faq-answer.open').forEach(openAnswer => {
                    if (openAnswer !== answer) {
                        openAnswer.classList.remove('open');
                        openAnswer.style.maxHeight = null;
                        const prevQuestion = openAnswer.previousElementSibling;
                        if (prevQuestion) {
                             prevQuestion.classList.remove('active');
                             const prevToggle = prevQuestion.querySelector('.faq-toggle');
                             if (prevToggle) prevToggle.textContent = '+';
                        }
                    }
                });
                answer.classList.toggle('open');
                question.classList.toggle('active');
                if (answer.classList.contains('open')) {
                    answer.style.maxHeight = answer.scrollHeight + "px";
                    if (toggle) toggle.textContent = '-';
                } else {
                    answer.style.maxHeight = null;
                    if (toggle) toggle.textContent = '+';
                }
            });
        });

        if (urlInput && label) {
            urlInput.addEventListener('focus', () => label.classList.add('float'));
            urlInput.addEventListener('blur', () => { if (!urlInput.value) label.classList.remove('float'); });
            if (urlInput.value) label.classList.add('float');
        }
        
        if (pasteBtn && urlInput) {
            pasteBtn.addEventListener('click', () => {
                navigator.clipboard.readText().then(text => {
                    urlInput.value = text;
                    if (label) label.classList.add('float');
                    urlInput.focus();
                    showMessage('', ''); // Clear message on new paste
                    playerSection.style.display = 'none'; // Hide player on new paste
                    teraboxPlayerIframe.src = 'about:blank';
                }).catch(err => {
                    console.error('Failed to read clipboard:', err);
                    showMessage('Failed to paste. Please paste manually.', 'error');
                });
            });
        }

        // --- Main "Load Media & Get Download Link" Button Logic ---
        if (getVideoBtn && urlInput) {
            getVideoBtn.addEventListener('click', async () => { // Made async
                const userLink = urlInput.value.trim();
                showMessage('', ''); 
                playerSection.style.display = 'none';
                teraboxPlayerIframe.src = 'about:blank';
                directDownloadBtn.href = '#';
                directDownloadBtn.classList.add('disabled');
                directDownloadBtn.innerHTML = '<i class="fas fa-download"></i> Download File';


                if (!userLink) {
                    showMessage('Please paste a Terabox URL first.', 'error');
                    return;
                }

                let fullUserLink = userLink;
                if (!userLink.startsWith('http://') && !userLink.startsWith('https://')) {
                    fullUserLink = 'https://' + userLink;
                }

                if (isValidTeraboxUrl(fullUserLink)) {
                    currentOriginalTeraboxLink = fullUserLink; // Store original for fallback

                    // Call the API
                    const details = await fetchTeraboxLinkDetails(fullUserLink);

                    if (details) {
                        // Populate UI with API details
                        loadedFileUrlSpan.textContent = fullUserLink;
                        loadedFileNameSpan.textContent = details.title || 'No Title Available';
                        
                        let fileSizeFormatted = 'Unknown Size';
                        if (details.size && !isNaN(details.size)) {
                            const sizeInBytes = parseInt(details.size);
                            if (sizeInBytes > 0) {
                                const i = Math.floor(Math.log(sizeInBytes) / Math.log(1024));
                                fileSizeFormatted = (sizeInBytes / Math.pow(1024, i)).toFixed(2) * 1 + ' ' + ['B', 'KB', 'MB', 'GB', 'TB'][i];
                            } else if (sizeInBytes === 0) {
                                fileSizeFormatted = "0 B";
                            }
                        }
                        loadedFileSizeSpan.textContent = fileSizeFormatted;

                        // Set iframe for player.teraboxfast.com (visual player)
                        teraboxPlayerIframe.src = `https://player.teraboxfast.com/terabox?q=${encodeURIComponent(fullUserLink)}`;
                        
                        // Determine the download link from API response
                        let downloadApiLink = '';
                        if (details.directDownloadBtn && details.directDownloadBtn !== '#' && details.directDownloadBtn.startsWith('http')) {
                            downloadApiLink = details.directDownloadBtn;
                        } else if (details.downloadUrl && details.downloadUrl !== '#' && details.downloadUrl.startsWith('http')) {
                            downloadApiLink = details.downloadUrl;
                        }

                        if (downloadApiLink) {
                            directDownloadBtn.href = downloadApiLink;
                            directDownloadBtn.classList.remove('disabled');
                            directDownloadBtn.innerHTML = '<i class="fas fa-download"></i> Download File (API)';
                            // Consider adding 'download' attribute if it's a direct file link from API
                            // directDownloadBtn.setAttribute('download', details.title || 'terabox_file');
                        } else {
                            // Fallback: Link to original Terabox page if API gives no good link
                            directDownloadBtn.href = currentOriginalTeraboxLink;
                            directDownloadBtn.classList.remove('disabled');
                            directDownloadBtn.innerHTML = '<i class="fas fa-external-link-alt"></i> Go to Terabox Page';
                            // directDownloadBtn.removeAttribute('download');
                        }
                        
                        playerSection.style.display = 'block';
                        showMessage('Player loaded. Use button for download options.', 'success');
                        playerSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    } else {
                        // API call failed or returned no usable data
                        // Error messages are already shown by fetchTeraboxLinkDetails
                        // Fallback to opening original link
                        directDownloadBtn.href = currentOriginalTeraboxLink; // Still allow going to original page
                        directDownloadBtn.classList.remove('disabled');
                        directDownloadBtn.innerHTML = '<i class="fas fa-exclamation-triangle"></i> API Failed - Go to Terabox Page';
                        playerSection.style.display = 'block'; // Show section even on API fail to allow original link access
                        loadedFileUrlSpan.textContent = fullUserLink;
                        loadedFileNameSpan.textContent = "API Error";
                        loadedFileSizeSpan.textContent = "N/A";

                    }
                } else {
                    showMessage('Invalid or unsupported Terabox URL. Please check and try again.', 'error');
                }
            });
        }
        
        // Populate supported URLs grid & current year
        const urlsGrid = document.getElementById('supportedUrlsGrid');
        if (urlsGrid) {
            supportedDomains.forEach(domain => {
                const urlDiv = document.createElement('div');
                urlDiv.classList.add('url-item');
                urlDiv.textContent = domain;
                urlsGrid.appendChild(urlDiv);
            });
        }
        if (currentYearSpan) {
            currentYearSpan.textContent = new Date().getFullYear();
        }
    });
    </script>
</body>
</html>
